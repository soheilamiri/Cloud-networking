-- by soheil.amiri 
-- to run this SQL need to import  template from online thwack repro. template name: ssl certificate expiration -CI,CN, and expiry date by stevenstadel

SELECT top 30 Caption as Node_name, ComponentStatisticData as expire_in, IpAddress as IP_Address
FROM Orion.Nodes AS [nodes]
INNER JOIN Orion.APM.CurrentStatistics AS [cert]
    ON [cert].NodeID = [nodes].NodeID
where [cert].ComponentStatisticData < 30



--KPI Warning
SELECT count (nodeid) as Qty
FROM Orion.APM.CurrentStatistics as [cert]
where [cert].ComponentStatisticData >= 10 AND [cert].ComponentStatisticData <= 20


--KPI INFO
SELECT count (nodeid) as Qty
FROM Orion.APM.CurrentStatistics as [cert]
where [cert].ComponentStatisticData >= 20

--KPI Critical 
SELECT count (nodeid) as Qty
FROM Orion.APM.CurrentStatistics as [cert]
where [cert].ComponentStatisticData <= 10


